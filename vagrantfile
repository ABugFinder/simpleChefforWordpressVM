Vagrant.configure("2") do |config|
    config.vm.box = "ubuntu/focal64"
    config.vm.synced_folder "cookbooks/php", "/var/chef/cookbooks/php"
    config.vm.network "forwarded_port", guest: 80, host: 8080

    config.vm.provision "shell", inline: <<-SHELL
      wget -qO- https://omnitruck.chef.io/install.sh | sudo bash -s -- -P chefdk

      export CHEF_LICENSE="accept"

      cd /vagrant && chef exec bundle install

      chown -R vagrant:vagrant /opt/chefdk
    SHELL

    config.vm.provision "chef_solo" do |chef|
      chef.version = "13.0"
      chef.add_recipe "wp-cb::default"
      chef.cookbooks_path = ["cookbooks"]
    end
  end
  